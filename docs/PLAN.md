# Exam Builder - 최종 계획서

> 학원 수학 월말고사 및 일상 문제지 자동 생성 시스템

---

## 1. 프로젝트 개요

### 1.1 문제 정의
- 17명+ 학생, 중1~고등 확률과통계까지 학년/단원/난이도가 전부 다름
- 매월 학생별 맞춤형 월말고사 + 일상 수업용 문제지를 수작업으로 만드는 것이 불가능
- AI가 생성한 문제에는 오류가 있으므로 반드시 수정 기능 필요

### 1.2 핵심 목표
1. **Local AI (Ollama)** 를 이용한 수학 문제 자동 생성
2. **문제 편집기** - AI 생성 문제의 오류 수정 (LaTeX 수식 지원)
3. **학생 맞춤형** - 프로필 기반 자동 시험지 구성
4. **PDF 출력** - 족보닷컴 스타일의 시험지 인쇄

### 1.3 확정 조건

| 항목 | 내용 |
|------|------|
| AI | Ollama (설치 완료), GPU 8GB+ → 14B 모델 사용 가능 |
| 용도 | 월말고사 + 일상 수업 문제지 |
| 문제 유형 | 객관식 (5지선다) + 서술형 |
| 학생 수 | 17명+, 중1~고등 확통까지 다양 |
| 플랫폼 | Node.js 20 로컬 웹앱 |

---

## 2. 경쟁 서비스 분석 & 참고 포인트

### 2.1 족보닷컴 (zocbo.com)
- **강점**: 1,237만 문항 보유, 25년 노하우, 난이도/출제경향 분석
- **구조**: 학년 > 대단원 > 중단원 > 소단원 > 유형 > 난이도
- **문제 형식**: 유형별 "체크 Point" 개념 요약, 난이도 표시(○●●), "꼭 나오는 문제"/"대표" 태그
- **참고할 점**: 단원-유형-난이도 3축 분류 체계, 시험지 레이아웃 디자인

### 2.2 매쓰플랫 (mathflat.com)
- **강점**: 1,246개 교재 연동, 학습지 제작, 오답관리, 취약유형 분석
- **기능**: 출제 범위/난이도 자유 설정, 다양한 디자인 템플릿, 쌍둥이/유사 문제
- **학생 관리**: 유형별 성취도 색상 시각화, 통계 리포트, 문자 발송
- **참고할 점**: 취약유형 분석 시스템, 오답 기반 유사 문제 추천

### 2.3 모두매쓰 (modoo-math.com)
- **강점**: AI 기반 수학 문제 무제한 생성, 초중고 전범위
- **기능**: 맞춤형 학습지 구성, 손글씨 인식, 프린트 기능
- **참고할 점**: AI 문제 생성 + 즉시 풀기 인터페이스

### 2.4 매쓰홀릭 (matholic.com)
- **강점**: 국내 최다 교과서/시중교재 연동
- **기능**: 오답/평가/유사/쌍둥이 문제, 기출 및 변형 시험지
- **참고할 점**: 쌍둥이 문제 (숫자만 바꾼 변형) 개념

### 2.5 우리 시스템에 반영할 핵심 기능
1. **단원-유형-난이도 3축 분류** (족보닷컴)
2. **AI 문제 생성 + 수동 편집** (모두매쓰 + 자체)
3. **쌍둥이/변형 문제 생성** (매쓰홀릭)
4. **학생별 취약유형 분석** (매쓰플랫) - Phase 3
5. **깔끔한 시험지 PDF 출력** (족보닷컴 스타일)

---

## 3. 전체 수학 교육과정 단원 트리 (2022 개정 교육과정)

### 3.1 중학교 1학년 수학

```
중1 수학
├── I. 수와 연산
│   ├── 1. 소인수분해
│   │   ├── 1-1-1. 거듭제곱
│   │   ├── 1-1-2. 소수와 합성수
│   │   ├── 1-1-3. 소인수분해
│   │   ├── 1-1-4. 최대공약수
│   │   └── 1-1-5. 최소공배수
│   └── 2. 정수와 유리수
│       ├── 1-2-1. 양수와 음수, 정수
│       ├── 1-2-2. 절댓값과 수직선
│       ├── 1-2-3. 정수와 유리수의 대소관계
│       ├── 1-2-4. 정수와 유리수의 덧셈과 뺄셈
│       └── 1-2-5. 정수와 유리수의 곱셈과 나눗셈
├── II. 변화와 관계
│   ├── 3. 문자와 식
│   │   ├── 2-1-1. 문자의 사용과 식의 값
│   │   ├── 2-1-2. 일차식의 계산
│   │   ├── 2-1-3. 일차방정식의 풀이
│   │   └── 2-1-4. 일차방정식의 활용
│   └── 4. 좌표평면과 그래프
│       ├── 2-2-1. 순서쌍과 좌표평면
│       ├── 2-2-2. 정비례와 그래프
│       └── 2-2-3. 반비례와 그래프
├── III. 도형과 측정
│   ├── 5. 기본도형
│   │   ├── 3-1-1. 점, 선, 면, 각
│   │   ├── 3-1-2. 위치 관계
│   │   ├── 3-1-3. 평행선의 성질
│   │   └── 3-1-4. 작도와 합동
│   ├── 6. 평면도형의 성질
│   │   ├── 3-2-1. 다각형의 성질
│   │   └── 3-2-2. 원과 부채꼴
│   └── 7. 입체도형의 성질
│       ├── 3-3-1. 다면체와 회전체
│       └── 3-3-2. 입체도형의 겉넓이와 부피
└── IV. 자료와 가능성
    └── 8. 자료의 정리와 해석
        ├── 4-1-1. 대푯값
        ├── 4-1-2. 도수분포표와 그래프
        └── 4-1-3. 상대도수
```

### 3.2 중학교 2학년 수학

```
중2 수학
├── I. 수와 식
│   ├── 1. 유리수와 순환소수
│   │   ├── 1-1-1. 유리수와 순환소수
│   │   └── 1-1-2. 순환소수의 분수 표현
│   └── 2. 단항식과 다항식의 계산
│       ├── 1-2-1. 지수법칙
│       ├── 1-2-2. 단항식의 곱셈과 나눗셈
│       └── 1-2-3. 다항식의 계산
├── II. 부등식과 연립방정식
│   ├── 3. 일차부등식
│   │   ├── 2-1-1. 부등식의 성질과 풀이
│   │   └── 2-1-2. 일차부등식의 활용
│   └── 4. 연립일차방정식
│       ├── 2-2-1. 연립방정식의 풀이
│       └── 2-2-2. 연립방정식의 활용
├── III. 일차함수
│   └── 5. 일차함수와 그래프
│       ├── 3-1-1. 일차함수의 뜻과 그래프
│       ├── 3-1-2. 일차함수의 식 구하기
│       └── 3-1-3. 일차함수와 일차방정식의 관계
├── IV. 도형의 성질
│   ├── 6. 삼각형의 성질
│   │   ├── 4-1-1. 이등변삼각형의 성질
│   │   ├── 4-1-2. 직각삼각형의 합동
│   │   └── 4-1-3. 삼각형의 외심과 내심
│   └── 7. 사각형의 성질
│       ├── 4-2-1. 평행사변형의 성질과 조건
│       └── 4-2-2. 여러 가지 사각형
├── V. 도형의 닮음
│   └── 8. 도형의 닮음
│       ├── 5-1-1. 닮음의 뜻과 성질
│       ├── 5-1-2. 삼각형의 닮음 조건
│       ├── 5-1-3. 평행선과 선분의 비
│       └── 5-1-4. 중점연결정리와 무게중심
├── VI. 피타고라스 정리
│   └── 9. 피타고라스 정리
│       ├── 6-1-1. 피타고라스 정리
│       └── 6-1-2. 피타고라스 정리의 활용
└── VII. 확률
    └── 10. 확률
        ├── 7-1-1. 경우의 수
        ├── 7-1-2. 확률의 뜻과 성질
        └── 7-1-3. 확률의 계산
```

### 3.3 중학교 3학년 수학

```
중3 수학
├── I. 실수와 그 계산
│   └── 1. 제곱근과 실수
│       ├── 1-1-1. 제곱근의 뜻과 성질
│       ├── 1-1-2. 무리수와 실수
│       ├── 1-1-3. 제곱근의 곱셈과 나눗셈
│       └── 1-1-4. 제곱근의 덧셈과 뺄셈
├── II. 다항식의 곱셈과 인수분해
│   └── 2. 곱셈공식과 인수분해
│       ├── 2-1-1. 다항식의 곱셈 (곱셈공식)
│       ├── 2-1-2. 곱셈공식의 변형
│       ├── 2-2-1. 인수분해 공식
│       └── 2-2-2. 인수분해 공식의 활용
├── III. 이차방정식
│   └── 3. 이차방정식
│       ├── 3-1-1. 이차방정식의 풀이 (인수분해)
│       ├── 3-1-2. 이차방정식의 풀이 (근의 공식)
│       ├── 3-1-3. 근의 개수와 판별식
│       └── 3-1-4. 이차방정식의 활용
├── IV. 이차함수
│   └── 4. 이차함수와 그래프
│       ├── 4-1-1. 이차함수의 그래프
│       ├── 4-1-2. 이차함수의 식 구하기
│       └── 4-1-3. 이차함수의 최댓값과 최솟값
├── V. 삼각비
│   └── 5. 삼각비
│       ├── 5-1-1. 삼각비의 뜻
│       ├── 5-1-2. 삼각비의 값
│       └── 5-1-3. 삼각비의 활용
├── VI. 원의 성질
│   └── 6. 원의 성질
│       ├── 6-1-1. 원과 직선 (현, 접선)
│       ├── 6-1-2. 원주각의 성질
│       └── 6-1-3. 원에 내접하는 사각형
└── VII. 통계
    └── 7. 대푯값과 산포도
        ├── 7-1-1. 대푯값
        ├── 7-1-2. 분산과 표준편차
        └── 7-1-3. 산점도와 상관관계
```

### 3.4 공통수학1 (고1)

```
공통수학1
├── I. 다항식
│   ├── 1. 다항식의 연산
│   │   ├── 1-1-1. 다항식의 덧셈과 뺄셈
│   │   ├── 1-1-2. 다항식의 곱셈과 나눗셈
│   │   └── 1-1-3. 곱셈 공식
│   ├── 2. 항등식과 나머지정리
│   │   ├── 1-2-1. 항등식
│   │   ├── 1-2-2. 나머지정리와 인수정리
│   │   └── 1-2-3. 조립제법
│   └── 3. 인수분해
│       ├── 1-3-1. 인수분해 공식
│       └── 1-3-2. 복잡한 식의 인수분해
├── II. 방정식과 부등식
│   ├── 4. 복소수와 이차방정식
│   │   ├── 2-1-1. 복소수
│   │   ├── 2-1-2. 이차방정식의 판별식
│   │   └── 2-1-3. 근과 계수의 관계
│   ├── 5. 이차방정식과 이차함수
│   │   └── 2-2-1. 이차방정식과 이차함수의 관계
│   ├── 6. 여러 가지 방정식
│   │   ├── 2-3-1. 고차방정식
│   │   └── 2-3-2. 연립방정식
│   └── 7. 여러 가지 부등식
│       ├── 2-4-1. 연립부등식
│       └── 2-4-2. 이차부등식
├── III. 경우의 수
│   └── 8. 경우의 수
│       ├── 3-1-1. 합의 법칙과 곱의 법칙
│       ├── 3-1-2. 순열
│       └── 3-1-3. 조합
└── IV. 행렬
    └── 9. 행렬
        ├── 4-1-1. 행렬의 뜻과 연산
        ├── 4-1-2. 행렬의 곱셈
        └── 4-1-3. 단위행렬
```

### 3.5 공통수학2 (고1)

```
공통수학2
├── I. 도형의 방정식
│   ├── 1. 평면좌표
│   │   ├── 1-1-1. 두 점 사이의 거리
│   │   └── 1-1-2. 내분점과 외분점
│   ├── 2. 직선의 방정식
│   │   ├── 1-2-1. 직선의 방정식
│   │   └── 1-2-2. 두 직선의 관계
│   ├── 3. 원의 방정식
│   │   ├── 1-3-1. 원의 방정식
│   │   └── 1-3-2. 원과 직선의 위치관계
│   └── 4. 도형의 이동
│       ├── 1-4-1. 평행이동
│       └── 1-4-2. 대칭이동
├── II. 집합과 명제
│   ├── 5. 집합
│   │   ├── 2-1-1. 집합의 뜻과 표현
│   │   └── 2-1-2. 집합의 연산
│   └── 6. 명제
│       ├── 2-2-1. 명제와 조건
│       └── 2-2-2. 필요조건과 충분조건
└── III. 함수와 그래프
    └── 7. 함수
        ├── 3-1-1. 함수의 뜻과 그래프
        ├── 3-1-2. 합성함수와 역함수
        ├── 3-1-3. 유리함수
        └── 3-1-4. 무리함수
```

### 3.6 대수 (일반선택)

```
대수
├── I. 지수함수와 로그함수
│   ├── 1. 지수
│   │   ├── 1-1-1. 거듭제곱과 거듭제곱근
│   │   └── 1-1-2. 지수의 확장과 지수법칙
│   ├── 2. 로그
│   │   ├── 1-2-1. 로그의 뜻과 성질
│   │   └── 1-2-2. 상용로그
│   ├── 3. 지수함수와 로그함수
│   │   ├── 1-3-1. 지수함수의 그래프
│   │   ├── 1-3-2. 로그함수의 그래프
│   │   └── 1-3-3. 지수함수와 로그함수의 활용
│   └── 4. 지수방정식과 로그방정식
│       ├── 1-4-1. 지수방정식과 부등식
│       └── 1-4-2. 로그방정식과 부등식
├── II. 삼각함수
│   ├── 5. 삼각함수
│   │   ├── 2-1-1. 일반각과 호도법
│   │   ├── 2-1-2. 삼각함수의 정의와 성질
│   │   └── 2-1-3. 삼각함수의 그래프
│   ├── 6. 삼각방정식과 부등식
│   │   └── 2-2-1. 삼각방정식과 삼각부등식
│   └── 7. 사인법칙과 코사인법칙
│       ├── 2-3-1. 사인법칙
│       ├── 2-3-2. 코사인법칙
│       └── 2-3-3. 삼각형의 넓이
└── III. 수열
    ├── 8. 등차수열과 등비수열
    │   ├── 3-1-1. 등차수열
    │   ├── 3-1-2. 등비수열
    │   └── 3-1-3. 등차/등비수열의 합
    ├── 9. 수열의 합
    │   ├── 3-2-1. 시그마(Σ)의 뜻과 성질
    │   └── 3-2-2. 여러 가지 수열의 합
    └── 10. 수학적 귀납법
        ├── 3-3-1. 귀납적 정의
        └── 3-3-2. 수학적 귀납법
```

### 3.7 미적분I (일반선택)

```
미적분I
├── I. 함수의 극한과 연속
│   ├── 1. 함수의 극한
│   │   ├── 1-1-1. 함수의 극한
│   │   ├── 1-1-2. 함수의 극한에 대한 성질
│   │   └── 1-1-3. 미정계수 결정
│   └── 2. 함수의 연속
│       ├── 1-2-1. 함수의 연속
│       ├── 1-2-2. 연속함수의 성질
│       └── 1-2-3. 최대·최소 정리와 사잇값 정리
├── II. 미분
│   ├── 3. 미분계수와 도함수
│   │   ├── 2-1-1. 미분계수
│   │   ├── 2-1-2. 도함수
│   │   └── 2-1-3. 도함수의 활용
│   ├── 4. 접선의 방정식
│   │   └── 2-2-1. 접선의 방정식
│   ├── 5. 함수의 그래프
│   │   ├── 2-3-1. 함수의 극대와 극소
│   │   ├── 2-3-2. 함수의 그래프
│   │   └── 2-3-3. 함수의 최댓값과 최솟값
│   └── 6. 방정식과 부등식에의 활용
│       └── 2-4-1. 방정식과 부등식에의 활용
└── III. 적분
    ├── 7. 부정적분
    │   ├── 3-1-1. 부정적분
    │   └── 3-1-2. 부정적분의 성질
    ├── 8. 정적분
    │   ├── 3-2-1. 정적분의 정의
    │   ├── 3-2-2. 정적분의 성질
    │   └── 3-2-3. 다항함수의 정적분
    └── 9. 정적분의 활용
        ├── 3-3-1. 넓이
        └── 3-3-2. 속도와 거리
```

### 3.8 확률과 통계 (일반선택)

```
확률과 통계
├── I. 경우의 수
│   ├── 1. 순열과 조합
│   │   ├── 1-1-1. 여러 가지 순열 (원순열, 중복순열, 같은것이 있는 순열)
│   │   ├── 1-1-2. 중복조합
│   │   └── 1-1-3. 조합의 활용
│   └── 2. 이항정리
│       ├── 1-2-1. 이항정리
│       └── 1-2-2. 이항계수의 성질
├── II. 확률
│   ├── 3. 확률의 뜻과 활용
│   │   ├── 2-1-1. 확률의 뜻과 기본 성질
│   │   └── 2-1-2. 확률의 덧셈정리
│   └── 4. 조건부확률
│       ├── 2-2-1. 조건부확률
│       ├── 2-2-2. 확률의 곱셈정리
│       └── 2-2-3. 독립시행의 확률
└── III. 통계
    ├── 5. 확률분포
    │   ├── 3-1-1. 확률변수와 확률분포
    │   ├── 3-1-2. 이항분포
    │   └── 3-1-3. 정규분포
    └── 6. 통계적 추정
        ├── 3-2-1. 모평균의 추정
        └── 3-2-2. 모비율의 추정
```

### 3.9 미적분II (진로선택)

```
미적분II
├── I. 수열의 극한
│   ├── 1. 수열의 극한
│   │   ├── 1-1-1. 수열의 수렴과 발산
│   │   ├── 1-1-2. 극한값의 계산
│   │   └── 1-1-3. 등비수열의 극한
│   └── 2. 급수
│       ├── 1-2-1. 급수의 수렴과 발산
│       ├── 1-2-2. 등비급수
│       └── 1-2-3. 등비급수의 활용
├── II. 미분법
│   ├── 3. 여러 가지 함수의 미분
│   │   ├── 2-1-1. 지수함수와 로그함수의 미분
│   │   ├── 2-1-2. 삼각함수의 미분
│   │   └── 2-1-3. 자연로그의 밑 e
│   └── 4. 여러 가지 미분법
│       ├── 2-2-1. 합성함수의 미분
│       ├── 2-2-2. 매개변수 미분
│       ├── 2-2-3. 음함수 미분
│       └── 2-2-4. 역함수 미분
└── III. 적분법
    ├── 5. 여러 가지 적분법
    │   ├── 3-1-1. 치환적분
    │   └── 3-1-2. 부분적분
    └── 6. 정적분의 활용
        ├── 3-2-1. 넓이와 부피
        ├── 3-2-2. 속도와 거리
        └── 3-2-3. 회전체의 부피
```

### 3.10 기하 (진로선택)

```
기하
├── I. 이차곡선
│   ├── 1. 포물선
│   │   ├── 1-1-1. 포물선의 방정식
│   │   └── 1-1-2. 포물선의 성질
│   ├── 2. 타원
│   │   ├── 1-2-1. 타원의 방정식
│   │   └── 1-2-2. 타원의 성질
│   └── 3. 쌍곡선
│       ├── 1-3-1. 쌍곡선의 방정식
│       └── 1-3-2. 쌍곡선의 성질
├── II. 공간도형과 공간좌표
│   ├── 4. 공간도형
│   │   ├── 2-1-1. 직선과 평면의 위치관계
│   │   ├── 2-1-2. 정사영
│   │   └── 2-1-3. 이면각
│   └── 5. 공간좌표
│       ├── 2-2-1. 점의 좌표
│       └── 2-2-2. 구의 방정식
└── III. 벡터
    ├── 6. 평면벡터
    │   ├── 3-1-1. 벡터의 연산
    │   ├── 3-1-2. 벡터의 내적
    │   └── 3-1-3. 직선과 원의 벡터 방정식
    └── 7. 공간벡터
        ├── 3-2-1. 공간벡터의 연산
        ├── 3-2-2. 공간벡터의 내적
        └── 3-2-3. 좌표공간에서의 활용
```

---

## 4. 시스템 아키텍처

### 4.1 기술 스택

| 영역 | 기술 | 이유 |
|------|------|------|
| Backend | Node.js 20 + Express | 프로젝트 기본 요구사항 |
| Frontend | React 18 + Vite + TailwindCSS | 빠른 개발, 수식 UI에 적합 |
| DB | SQLite (better-sqlite3) | 로컬 앱, 설치 간단, 별도 서버 불필요 |
| AI | Ollama REST API | 로컬 LLM, 비용 0원 |
| 수식 렌더링 | KaTeX | MathJax보다 빠름, 서버/클라이언트 모두 지원 |
| 수식 편집 | MathLive | WYSIWYG LaTeX 편집기, 한국어 수학 기호 지원 |
| PDF 생성 | Puppeteer | HTML→PDF 변환, KaTeX 수식 포함 가능 |

### 4.2 시스템 구조도

```
┌─────────────────────────────────────────────────────────────┐
│                 Exam Builder (localhost:3000)                 │
├─────────────────────────────────────────────────────────────┤
│                                                              │
│  [React Frontend]                                            │
│  ├── 📊 대시보드                                              │
│  │   ├── 학생 목록 (진도 현황)                                 │
│  │   └── 최근 생성 시험지                                      │
│  ├── 👤 학생 관리                                              │
│  │   ├── 프로필 (이름, 학년, 현재 단원, 난이도)                  │
│  │   ├── 특수 조건 (서술형필수, 특정단원제외 등)                  │
│  │   └── 학생 그룹 관리                                        │
│  ├── 📚 문제 은행                                              │
│  │   ├── 단원/유형/난이도 필터                                  │
│  │   ├── 문제 검색                                             │
│  │   └── 문제 상세 보기 (수식 렌더링)                           │
│  ├── 🤖 AI 문제 생성                                           │
│  │   ├── 단원/유형/난이도/문제수 설정                            │
│  │   ├── 실시간 스트리밍 생성                                   │
│  │   └── 생성 결과 미리보기                                     │
│  ├── ✏️ 문제 편집기 (핵심!)                                     │
│  │   ├── 문제 본문 편집 (MathLive LaTeX)                        │
│  │   ├── 보기 편집 (5지선다)                                    │
│  │   ├── 정답/풀이 편집                                         │
│  │   ├── 서술형 풀이 과정 편집                                   │
│  │   └── [승인] / [수정] / [삭제] / [재생성]                    │
│  └── 📝 시험지 빌더                                             │
│      ├── 학생 선택 → 자동 문제 추천                              │
│      ├── 드래그&드롭 문제 배치                                   │
│      ├── PDF 미리보기                                           │
│      └── PDF 다운로드 (시험지 + 답안지)                          │
│                                                              │
│  [Express Backend]                                           │
│  ├── /api/students      학생 CRUD                             │
│  ├── /api/curriculum     교육과정 단원 트리 조회                 │
│  ├── /api/problems       문제 은행 CRUD + 검색                  │
│  ├── /api/generate       Ollama 연동 문제 생성                  │
│  ├── /api/exams          시험지 조합 & 관리                     │
│  └── /api/export/pdf     PDF 생성 & 다운로드                    │
│                                                              │
│  [SQLite Database]                                           │
│  ├── curriculum          교육과정 단원 트리 (위 3장 전체)         │
│  ├── students            학생 프로필                             │
│  ├── student_conditions  학생별 특수 조건                        │
│  ├── problems            문제 본문, LaTeX, 보기, 정답, 풀이      │
│  ├── problem_tags        문제 태그 (다대다)                      │
│  ├── exams               시험지 메타데이터                        │
│  └── exam_problems       시험지-문제 매핑                        │
│                                                              │
│  [Ollama - localhost:11434]                                  │
│  └── qwen2.5:14b 또는 deepseek-r1:14b                        │
│                                                              │
└─────────────────────────────────────────────────────────────┘
```

### 4.3 데이터 모델

```sql
-- 교육과정 단원 트리
CREATE TABLE curriculum (
  id INTEGER PRIMARY KEY,
  subject TEXT NOT NULL,      -- '중1수학', '중2수학', ... '기하'
  chapter_code TEXT NOT NULL, -- '1-1-1', '1-2-3' 등
  level1 TEXT NOT NULL,       -- 대단원: 'I. 수와 연산'
  level2 TEXT NOT NULL,       -- 중단원: '1. 소인수분해'
  level3 TEXT NOT NULL,       -- 소단원: '소인수분해'
  sort_order INTEGER
);

-- 학생
CREATE TABLE students (
  id INTEGER PRIMARY KEY,
  name TEXT NOT NULL,
  grade TEXT NOT NULL,            -- '중1', '중2', '고1' 등
  subject TEXT NOT NULL,          -- '중2수학', '공통수학1' 등
  current_chapter TEXT,           -- 현재 진도 chapter_code
  difficulty_level TEXT DEFAULT 'basic', -- 'basic','intermediate','advanced'
  group_name TEXT,                -- 그룹 (같은 진도 학생 묶기)
  notes TEXT,                     -- 메모
  created_at DATETIME DEFAULT CURRENT_TIMESTAMP
);

-- 학생별 특수 조건
CREATE TABLE student_conditions (
  id INTEGER PRIMARY KEY,
  student_id INTEGER REFERENCES students(id),
  condition_type TEXT NOT NULL,   -- 'require_descriptive', 'exclude_chapter', 'only_easy'
  condition_value TEXT,           -- 구체적 값
  description TEXT                -- '서술형 필수', '평균값정리 제외' 등
);

-- 문제
CREATE TABLE problems (
  id INTEGER PRIMARY KEY,
  type TEXT NOT NULL,             -- 'multiple_choice', 'descriptive'
  subject TEXT NOT NULL,          -- '중2수학'
  chapter_code TEXT NOT NULL,     -- '1-1-1'
  pattern_type TEXT,              -- '유형01', '유형02' 등
  pattern_name TEXT,              -- '유리수와 소수'
  difficulty INTEGER DEFAULT 2,  -- 1=하, 2=중, 3=상
  question TEXT NOT NULL,         -- 문제 본문 (LaTeX 포함)
  choices TEXT,                   -- JSON: ["①...", "②...", ...] (객관식)
  answer TEXT NOT NULL,           -- 정답
  solution TEXT,                  -- 풀이 과정 (LaTeX 포함)
  status TEXT DEFAULT 'draft',   -- 'draft', 'reviewed', 'approved', 'rejected'
  source TEXT DEFAULT 'ai',      -- 'ai', 'manual', 'imported'
  ai_model TEXT,                  -- 생성에 사용된 모델명
  created_at DATETIME DEFAULT CURRENT_TIMESTAMP,
  updated_at DATETIME DEFAULT CURRENT_TIMESTAMP
);

-- 문제 태그
CREATE TABLE problem_tags (
  problem_id INTEGER REFERENCES problems(id),
  tag TEXT NOT NULL,
  PRIMARY KEY (problem_id, tag)
);

-- 시험지
CREATE TABLE exams (
  id INTEGER PRIMARY KEY,
  title TEXT NOT NULL,            -- '2026년 2월 월말고사 - 김지후'
  exam_type TEXT NOT NULL,        -- 'monthly', 'daily', 'practice'
  student_id INTEGER REFERENCES students(id),
  created_at DATETIME DEFAULT CURRENT_TIMESTAMP
);

-- 시험지-문제 매핑
CREATE TABLE exam_problems (
  exam_id INTEGER REFERENCES exams(id),
  problem_id INTEGER REFERENCES problems(id),
  sort_order INTEGER,
  PRIMARY KEY (exam_id, problem_id)
);
```

---

## 5. AI 문제 생성 전략

### 5.1 모델 선택
- **1순위**: `qwen2.5:14b` - 한국어 + 수학 추론 모두 강점
- **2순위**: `deepseek-r1:14b` - 수학 추론 특화
- GPU 8GB+ → 14B 모델 Q4_K_M 양자화로 실행 가능

### 5.2 프롬프트 템플릿

```
## 객관식 문제 생성 프롬프트

당신은 한국 수학 교사입니다. 다음 조건에 맞는 수학 문제를 생성하세요.

### 조건
- 과목: {subject} (예: 중2 수학)
- 단원: {chapter_code} {chapter_name} (예: 1-1-1 유리수와 순환소수)
- 유형: {pattern_name} (예: 순환소수를 분수로 나타내기)
- 난이도: {difficulty} (하/중/상)
- 문제 유형: 객관식 5지선다

### 출력 형식 (반드시 JSON으로)
{
  "question": "문제 본문 (LaTeX 수식은 $...$ 로 감싸기)",
  "choices": ["① ...", "② ...", "③ ...", "④ ...", "⑤ ..."],
  "answer": 3,
  "solution": "단계별 풀이 과정 (LaTeX 수식 포함)",
  "tags": ["관련 키워드"]
}

### 참고 문제 (few-shot)
{example_problems}

### 주의사항
- 정답이 반드시 정확해야 합니다
- 오답 보기도 그럴듯한 오답이어야 합니다
- 풀이 과정은 단계별로 상세히 작성하세요
- LaTeX 수식: 분수는 \frac{}{}, 제곱근은 \sqrt{}, 순환소수는 \dot 사용
```

```
## 서술형 문제 생성 프롬프트

### 조건
- 과목: {subject}
- 단원: {chapter_code} {chapter_name}
- 난이도: {difficulty}
- 문제 유형: 서술형 (풀이 과정 필수)

### 출력 형식 (반드시 JSON으로)
{
  "question": "문제 본문",
  "answer": "최종 답",
  "solution_steps": [
    {"step": 1, "description": "...", "latex": "..."},
    {"step": 2, "description": "...", "latex": "..."},
    ...
  ],
  "tags": ["관련 키워드"]
}
```

### 5.3 문제 검증 워크플로우

```
AI 생성 → draft 상태
    ↓
선생님 검토
    ├── [승인] → approved (문제 은행에 저장)
    ├── [수정] → 편집기에서 수정 후 approved
    ├── [재생성] → AI에게 같은 조건으로 다시 요청
    └── [삭제] → rejected (삭제)
```

---

## 6. 개발 로드맵

### Phase 1 - MVP (핵심 기능)

```
1.1 프로젝트 초기화
    - Node.js + Express 서버 설정
    - React + Vite + TailwindCSS 프론트엔드 설정
    - SQLite 데이터베이스 + 교육과정 시드 데이터

1.2 교육과정 & 학생 관리
    - 교육과정 단원 트리 API + UI
    - 학생 프로필 CRUD
    - 학생 특수 조건 관리

1.3 AI 문제 생성
    - Ollama REST API 연동
    - 객관식/서술형 프롬프트 템플릿
    - 실시간 스트리밍 생성 UI

1.4 문제 편집기 (핵심)
    - MathLive LaTeX 수식 편집기 연동
    - 문제/보기/정답/풀이 CRUD
    - KaTeX 수식 미리보기
    - 승인/반려 워크플로우

1.5 시험지 생성 & PDF 출력
    - 문제 선택 → 시험지 구성
    - Puppeteer HTML→PDF 변환
    - 답안지 자동 생성
```

### Phase 2 - 문제 은행 & 자동화

```
2.1 문제 은행 고도화
    - 단원/유형/난이도 필터 검색
    - 승인된 문제 DB 축적
    - 문제 변형 생성 (숫자 변경)

2.2 시험지 자동 구성
    - 학생 프로필 기반 자동 문제 추천
    - 학생 그룹별 일괄 시험지 생성
    - 시험지 템플릿 (족보닷컴 스타일)
```

### Phase 3 - 분석 & 확장

```
3.1 학습 분석
    - 학생별 취약 유형 분석
    - 진도 추적 & 다음 단원 추천
    - 오답 기반 유사 문제 추천

3.2 기존 문제 가져오기
    - PDF 문제지 텍스트 추출 (OCR)
    - 기존 문제를 DB로 마이그레이션
```

---

## 7. 참고 출처

- [족보닷컴](https://www.zocbo.com/) - 문제 레이아웃 참고
- [매쓰플랫](https://www.mathflat.com/) - 학습지 제작 / 취약유형 분석 참고
- [모두매쓰](https://www.modoo-math.com/) - AI 문제 생성 참고
- [매쓰홀릭](https://www.matholic.com/) - 쌍둥이/변형 문제 참고
- [수학방](https://mathbang.net/) - 교육과정 단원 목차 참고
- [나무위키 - 2022 개정 교육과정/수학과](https://namu.wiki/w/2022%20%EA%B0%9C%EC%A0%95%20%EA%B5%90%EC%9C%A1%EA%B3%BC%EC%A0%95/%EC%88%98%ED%95%99%EA%B3%BC) - 교육과정 구조 참고
